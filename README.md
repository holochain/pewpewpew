# pewpewpew

- nix-shell sources `.env` in shell hook to make local bash dev easier
- add pewpewpew benchmarking server
  - implemented using actix
  - there is a shared actor wrapping the benchmarking script to enforce serial benchmarks but allow concurrent web requests
  - includes github signature checking and push parsing for webhooks
  - relies on scripts provided by nix-shell to allow for dependency management from nix
- adds nix shell commands for working with and internal to pewpewpew
- adds ngrok to nix shell for local testing of webhooks
- adds jq to nix shell for json handling in bash
- compares all benchmarks to develop
- pushes results of benchmarks in a comment to github commit
- keeps raw data locally for benchmarks

## future work

- host the static pages generated by criterion in some way that can be navigated
- refine the commenting process (it will probably get spammy, maybe we can delete/edit old comments when we add new ones)

## ingredients

- installed nix-shell
- NIXPKGS_ALLOW_UNFREE=1 environment variable set
- 3 terminal tabs
- a `.env` file provided by me
- admin access to the repo

## how to use

0. drop into a nix-shell in the first tab
0. run `pewpewpew-ngrok` to start an ngrok server
0. edit the github webhook on this repo to point to the ngrok URL
0. drop into a nix-shell in the second tab
0. run `pewpewpew` to start the benchmarking server
0. in the third tab push an empty git commit `git commit --allow-empty -m'test' && git push`
0. in the first tab you should see `202 accepted` - if not you probably don't have the correct `$GITHUB_WEBHOOK_SECRET`
0. in the second tab you should see benchmarking kick off
0. push another commit, you should see an immediate/concurrent accept in the first tab, but the second should complete benchmarks serially
